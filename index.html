<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é’æ˜¥äº¤æ›æ‰€ | å…¬é–‹å‹Ÿé›†ä¸­</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans TC', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
            animation: fadeInDown 1s ease-out;
        }

        .header h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            margin-bottom: 40px;
        }

        .story-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            animation: fadeInLeft 1s ease-out;
        }

        .submission-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            animation: fadeInRight 1s ease-out;
        }

        .section-title {
            color: #764ba2;
            font-size: 1.8rem;
            margin-bottom: 20px;
            text-align: center;
        }

        .story-description {
            line-height: 1.8;
            margin-bottom: 30px;
            font-size: 1.1rem;
        }

        .collection-list {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .collection-list h3 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .collection-item {
            display: flex;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }

        .collection-item:last-child {
            border-bottom: none;
        }

        .collection-item::before {
            content: "â™¡";
            color: #ff6b6b;
            font-size: 1.2rem;
            margin-right: 10px;
        }

        .memory-wall {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .memory-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .memory-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }

        .memory-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1);
        }

        .memory-tag {
            background: #667eea;
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            display: inline-block;
            margin-bottom: 10px;
        }

        .memory-content {
            font-size: 1rem;
            line-height: 1.6;
            color: #555;
        }

        .reaction-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .reaction-btn {
            padding: 8px 15px;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            position: relative;
        }

        .reaction-btn.heart {
            background: #ff6b6b;
            color: white;
        }

        .reaction-btn.relate {
            background: #4ecdc4;
            color: white;
        }

        .reaction-btn.warm {
            background: #ffa726;
            color: white;
        }

        .reaction-btn:hover {
            transform: scale(1.05);
        }

        .reaction-count {
            font-size: 0.8rem;
            margin-left: 5px;
        }

        .submit-form {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 15px;
            padding: 25px;
            color: white;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-family: inherit;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .submit-btn {
            background: #ff6b6b;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 25px;
            font-size: 1.1rem;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .submit-btn:hover {
            background: #ff5252;
            transform: translateY(-2px);
        }

        .floating-hearts {
            position: fixed;
            pointer-events: none;
            z-index: 1000;
        }

        .floating-heart {
            position: absolute;
            color: #ff6b6b;
            font-size: 20px;
            animation: floatUp 3s ease-out forwards;
        }

        @keyframes floatUp {
            0% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
            100% {
                opacity: 0;
                transform: translateY(-100px) scale(0.5);
            }
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInLeft {
            from {
                opacity: 0;
                transform: translateX(-50px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes fadeInRight {
            from {
                opacity: 0;
                transform: translateX(50px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .stats-bar {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-around;
            text-align: center;
        }

        .stat-item {
            flex: 1;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #666;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .memory-wall {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>é’æ˜¥äº¤æ›æ‰€</h1>
            <p class="subtitle">å…¬é–‹å‹Ÿé›†ä¸­ â™¡</p>
        </div>

        <div class="stats-bar">
            <div class="stat-item">
                <div class="stat-number" id="storyCount">42</div>
                <div class="stat-label">é’æ˜¥æ•…äº‹</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="objectCount">28</div>
                <div class="stat-label">çè—ç‰©ä»¶</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="secretCount">31</div>
                <div class="stat-label">ç§˜å¯†å¿ƒäº‹</div>
            </div>
        </div>

        <div class="main-content">
            <div class="story-section">
                <h2 class="section-title">é‚£äº›é’æ˜¥çš„ç‰‡æ®µ</h2>
                <div class="story-description">
                    é‚£äº›ä½ è—äº†å¾ˆä¹…å»é‚„æ²’å¥½å¥½èªªå®Œçš„é’æ˜¥æ•…äº‹ï¼Œèƒ½ä¸èƒ½å€Ÿæˆ‘å€‘åˆ†äº«ï¼
                    <br><br>
                    ç•¢æ¥­å­£é€²è¡Œä¸­çš„ç¾åœ¨ï¼Œé’æ˜¥ä¹Ÿæº–å‚™æ‰“åŒ…é›¢é–‹ã€‚æˆ‘å€‘æƒ³é‚€è«‹ä½ æŠŠé‚£æ®µå¹´å°‘æ™‚å…‰ç•™ä¸‹ä¾† â™¡
                </div>
                
                <div class="collection-list">
                    <h3>æˆ‘å€‘æ­£åœ¨å‹Ÿé›†ï¼š</h3>
                    <div class="collection-item">ä¸€å€‹ä½ æƒ³åˆ†äº«çš„ã€Œé’æ˜¥ç‰©ä»¶ã€èˆ‡å®ƒçš„æ•…äº‹</div>
                    <div class="collection-item">é‚£äº›æ›¾ç¶“å¯«éå»æ²’å‚³å‡ºå»çš„è©±</div>
                    <div class="collection-item">æ ¡åœ’æ™‚æœŸçš„éºæ†¾ã€ç¬‘è©±ã€æ„›æˆ€ã€æ„å¤–</div>
                    <div class="collection-item">ä¸æ•¢èªªçš„ç¥•å¯†</div>
                    <div class="collection-item">ä»»ä½•ä½ é¡˜æ„äº¤æ›çš„é’æ˜¥è¨˜æ†¶</div>
                </div>
            </div>

            <div class="submission-section">
                <h2 class="section-title">åˆ†äº«ä½ çš„é’æ˜¥</h2>
                <form class="submit-form" id="submitForm">
                    <div class="form-group">
                        <label for="storyType">æ•…äº‹é¡å‹</label>
<select id="storyType" name="storyType">
    <option value="">é¸æ“‡ä¸€å€‹é¡å‹...</option>
    <option value="åˆæˆ€å›æ†¶">åˆæˆ€å›æ†¶</option>
    <option value="å‹æƒ…æ­²æœˆ">å‹æƒ…æ­²æœˆ</option>
    <option value="é’æ˜¥ç§˜å¯†">é’æ˜¥ç§˜å¯†</option>
    <option value="éºæ†¾å¾€äº‹">éºæ†¾å¾€äº‹</option>
    <option value="çè—ç‰©ä»¶">çè—ç‰©ä»¶</option>
    <option value="å…¶ä»–">å…¶ä»–</option>
</select>

                    </div>
                    
                    <div class="form-group">
                        <label for="storyTitle">çµ¦ä½ çš„æ•…äº‹ä¸€å€‹æ¨™é¡Œ</label>
                        <input type="text" id="storyTitle" name="storyTitle" placeholder="ä¾‹å¦‚ï¼šé‚£æ¢æ°¸é æ²’é‚„çš„é«®åœˆ...">
                    </div>
                    
                    <div class="form-group">
                        <label for="storyContent">ä½ çš„é’æ˜¥æ•…äº‹</label>
                        <textarea id="storyContent" name="storyContent" placeholder="å‘Šè¨´æˆ‘å€‘é€™å€‹æ•…äº‹å§..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="nickname">åŒ¿åæš±ç¨±ï¼ˆå¯é¸ï¼‰</label>
                        <input type="text" id="nickname" name="nickname" placeholder="ä¾‹å¦‚ï¼šæ°¸é çš„17æ­²">
                    </div>
                    
                    <button type="submit" class="submit-btn">äº¤æ›æˆ‘çš„é’æ˜¥ â™¡</button>
                </form>
            </div>
        </div>

        <div class="memory-wall" id="memoryWall">
            <!-- é’æ˜¥è¨˜æ†¶å¡ç‰‡æœƒåœ¨é€™è£¡å‹•æ…‹ç”Ÿæˆ -->
        </div>
    </div>

    <div class="floating-hearts" id="floatingHearts"></div>

    <script>
        // Airtable è¨­å®š
        const AIRTABLE_CONFIG = {
            baseId: 'appEz6VXIIpZ2KTfC', // éœ€è¦æ›¿æ›æˆä½ çš„ Airtable Base ID
            apiKey: 'patezBdct7FwZehDI.43be2550062e7e18583319c466ab0e681935beb1ee71c8f4c94f8eb7c874c7e3', // éœ€è¦æ›¿æ›æˆä½ çš„ Airtable API Key
            tableName: 'YouthStories' // è³‡æ–™è¡¨åç¨±
        };

        // å…¨åŸŸè®Šæ•¸
        let memories = [];
        let isLoading = false;

        // ç¤ºä¾‹è¨˜æ†¶æ•¸æ“šï¼ˆä½œç‚ºé è¨­é¡¯ç¤ºï¼‰
        const sampleMemories = [
            {
                id: 'sample1',
                type: "åˆæˆ€å›æ†¶",
                title: "é‚£æ¢æ°¸é æ²’é‚„çš„é«®åœˆ",
                content: "é«˜ä¸‰çš„æ™‚å€™ï¼Œæš—æˆ€çš„å¥³å­©å€Ÿäº†æˆ‘ä¸€æ¢é«®åœˆï¼Œèªªé ­é«®å¤ªé•·æœƒæ“‹ä½è¦–ç·šã€‚æˆ‘ä¸€ç›´æƒ³æ‰¾æ©Ÿæœƒé‚„çµ¦å¥¹ï¼Œä½†ç¸½æ˜¯éŒ¯éæ™‚æ©Ÿã€‚ç¾åœ¨é€™æ¢é«®åœˆé‚„åœ¨æˆ‘çš„æŠ½å±œè£¡ï¼Œæˆäº†æˆ‘é’æ˜¥æœ€çè²´çš„å›æ†¶ã€‚",
                reactions: { heart: 15, relate: 23, warm: 8 }
            },
            {
                id: 'sample2',
                type: "å‹æƒ…æ­²æœˆ", 
                title: "æ°¸é çš„æ”¾å­¸å¾Œ",
                content: "æ¯å¤©æ”¾å­¸å¾Œï¼Œæˆ‘å€‘ä¸‰å€‹äººç¸½æ˜¯æœƒåœ¨å­¸æ ¡é–€å£çš„å°æ”¤è²©è²·å€‹é›è›‹ç³•ï¼Œç„¶å¾Œä¸€èµ·èµ°è·¯å›å®¶ã€‚é‚£æ™‚å€™è¦ºå¾—é€™æ¨£çš„æ—¥å­æœƒæ°¸é æŒçºŒä¸‹å»ï¼Œæ²’æƒ³åˆ°ç•¢æ¥­å¾Œå¤§å®¶éƒ½å„å¥”æ±è¥¿äº†ã€‚",
                reactions: { heart: 28, relate: 41, warm: 19 }
            },
            {
                id: 'sample3',
                type: "é’æ˜¥ç§˜å¯†",
                title: "è—åœ¨èª²æœ¬è£¡çš„ç´™æ¢",
                content: "åœ‹ä¸­æ™‚å¯«äº†ä¸€å¼µç´™æ¢æƒ³è¦çµ¦å–œæ­¡çš„äººï¼Œä½†ä¸€ç›´æ²’æœ‰å‹‡æ°£äº¤å‡ºå»ã€‚é‚£å¼µç´™æ¢æˆ‘å¤¾åœ¨æ•¸å­¸èª²æœ¬è£¡é¢ï¼Œæ¯æ¬¡ç¿»åˆ°éƒ½æœƒå¿ƒè·³åŠ é€Ÿã€‚ç›´åˆ°ç¾åœ¨ï¼Œæˆ‘éƒ½ä¸çŸ¥é“å¦‚æœç•¶æ™‚äº¤å‡ºå»æœƒæ˜¯ä»€éº¼çµæœã€‚",
                reactions: { heart: 31, relate: 37, warm: 12 }
            },
            {
                id: 'sample4',
                type: "éºæ†¾å¾€äº‹",
                title: "é‚£å ´æ²’åƒåŠ çš„ç•¢æ¥­æ—…è¡Œ",
                content: "é«˜ä¸‰çš„ç•¢æ¥­æ—…è¡Œï¼Œå› ç‚ºå®¶è£¡ç¶“æ¿Ÿç‹€æ³ä¸å…è¨±è€Œæ²’æœ‰åƒåŠ ã€‚çœ‹è‘—åŒå­¸å€‘åœ¨ç¤¾ç¾¤åª’é«”ä¸Šåˆ†äº«ç…§ç‰‡ï¼Œå¿ƒè£¡æ—¢ç¾¨æ…•åˆé›£éã€‚ç¾åœ¨æƒ³æƒ³ï¼Œé‚£äº›å›æ†¶æ˜¯è²·ä¸å›ä¾†çš„ã€‚",
                reactions: { heart: 22, relate: 18, warm: 25 }
            },
            {
                id: 'sample5',
                type: "çè—ç‰©ä»¶",
                title: "è¤ªè‰²çš„é›»å½±ç¥¨æ ¹",
                content: "å’Œåˆæˆ€ä¸€èµ·çœ‹çš„ç¬¬ä¸€éƒ¨é›»å½±ç¥¨æ ¹ï¼Œæˆ‘ä¸€ç›´ä¿å­˜åˆ°ç¾åœ¨ã€‚é›–ç„¶ä¸Šé¢çš„å­—å·²ç¶“è¤ªè‰²åˆ°çœ‹ä¸æ¸…æ¥šï¼Œä½†æ¯æ¬¡çœ‹åˆ°å®ƒï¼Œéƒ½æœƒæƒ³èµ·é‚£å€‹ä¸‹åˆçš„é™½å…‰å’Œå¥¹çš„ç¬‘å®¹ã€‚",
                reactions: { heart: 35, relate: 29, warm: 16 }
            },
            {
                id: 'sample6',
                type: "åˆæˆ€å›æ†¶",
                title: "æ¨“æ¢¯é–“çš„å‘Šç™½",
                content: "é«˜äºŒçš„æ™‚å€™ï¼Œé¼“èµ·å‹‡æ°£åœ¨æ¨“æ¢¯é–“è·Ÿå–œæ­¡çš„äººå‘Šç™½ã€‚é›–ç„¶è¢«æ‹’çµ•äº†ï¼Œä½†é‚£ç¨®å‹‡æ•¢çš„æ„Ÿè¦ºï¼Œé‚„æœ‰å¿ƒè·³å¿«åˆ°è¦è·³å‡ºä¾†çš„ç·Šå¼µï¼Œç¾åœ¨æƒ³èµ·ä¾†éƒ½è¦ºå¾—å¾ˆçè²´ã€‚",
                reactions: { heart: 18, relate: 24, warm: 13 }
            }
        ];

        // Airtable API å‡½æ•¸
        async function fetchStoriesFromAirtable() {
            // å¦‚æœæ²’æœ‰è¨­å®š API Keyï¼Œä½¿ç”¨ç¤ºä¾‹è³‡æ–™
            if (AIRTABLE_CONFIG.apiKey === 'YOUR_API_KEY') {
                console.log('ä½¿ç”¨ç¤ºä¾‹è³‡æ–™ï¼ˆè«‹è¨­å®š Airtable API Key ä»¥ä½¿ç”¨çœŸå¯¦è³‡æ–™ï¼‰');
                return sampleMemories;
            }

            try {
                const response = await fetch(`https://api.airtable.com/v0/${AIRTABLE_CONFIG.baseId}/${AIRTABLE_CONFIG.tableName}`, {
                    headers: {
                        'Authorization': `Bearer ${AIRTABLE_CONFIG.apiKey}`
                    }
                });

                if (!response.ok) {
                    throw new Error('ç„¡æ³•å¾ Airtable ç²å–è³‡æ–™');
                }

                const data = await response.json();
                
                return data.records.map(record => ({
                    id: record.id,
                    type: record.fields['Story Type'] || 'å…¶ä»–',
                    title: record.fields['Title'] || 'ç„¡æ¨™é¡Œ',
                    content: record.fields['Content'] || '',
                    nickname: record.fields['Nickname'] || 'åŒ¿å',
                    reactions: {
                        heart: record.fields['Heart Count'] || 0,
                        relate: record.fields['Relate Count'] || 0,
                        warm: record.fields['Warm Count'] || 0
                    },
                    timestamp: record.fields['Timestamp']
                }));
            } catch (error) {
                console.error('è¼‰å…¥æ•…äº‹å¤±æ•—:', error);
                return sampleMemories; // ç™¼ç”ŸéŒ¯èª¤æ™‚è¿”å›ç¤ºä¾‹è³‡æ–™
            }
        }

async function submitStoryToAirtable(storyData) {
    if (AIRTABLE_CONFIG.apiKey === 'YOUR_API_KEY') {
        console.log('æ¨¡æ“¬æäº¤åˆ° Airtable:', storyData);
        return {
            id: 'local_' + Date.now(),
            ...storyData,
            reactions: { heart: 0, relate: 0, warm: 0 }
        };
    }

    try {
        // ğŸ” åŠ åœ¨é€™è£¡ï¼
        console.log('é€å‡ºåˆ° Airtable çš„å…§å®¹:', {
            'Name': `${storyData.type}ï½œ${storyData.title || 'ç„¡æ¨™é¡Œ'}`,
            'æ•…äº‹é¡å‹': storyData.type,
            'æ¨™é¡Œ': storyData.title,
            'å…§å®¹': storyData.content,
            'åŒ¿åæš±ç¨±': storyData.nickname || 'åŒ¿å',
            'å¿ƒå‹•â™¡æ•¸é‡': 0,
            'æˆ‘ä¹Ÿæ˜¯': 0,
            'å¥½æº«æš–': 0,
            'Timestamp': new Date().toISOString()
        });

        const response = await fetch(`https://api.airtable.com/v0/${AIRTABLE_CONFIG.baseId}/${AIRTABLE_CONFIG.tableName}`, {
            method: 'POST',
            headers: {
                'Authorization': `Bearer ${AIRTABLE_CONFIG.apiKey}`,
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                fields: {
                    'Name': `${storyData.type}ï½œ${storyData.title || 'ç„¡æ¨™é¡Œ'}`,
                    'æ•…äº‹é¡å‹': storyData.type,
                    'æ¨™é¡Œ': storyData.title,
                    'å…§å®¹': storyData.content,
                    'åŒ¿åæš±ç¨±': storyData.nickname || 'åŒ¿å',
                    'å¿ƒå‹•â™¡æ•¸é‡': 0,
                    'æˆ‘ä¹Ÿæ˜¯': 0,
                    'å¥½æº«æš–': 0,
                    'Timestamp': new Date().toISOString()
                }
            })
        });

        if (!response.ok) {
                const errorDetail = await response.json(); // << åŠ é€™è¡Œ
    console.error('Airtable å›å‚³éŒ¯èª¤å…§å®¹:', errorDetail); // << ä»¥åŠé€™è¡Œ
            throw new Error('ç„¡æ³•æäº¤åˆ° Airtable');
        }

        const data = await response.json();
        return {
            id: data.id,
            ...storyData,
            reactions: { heart: 0, relate: 0, warm: 0 }
        };
    } catch (error) {
        console.error('æäº¤å¤±æ•—:', error);
        throw error;
    }
}



   async function updateReactionInAirtable(storyId, reactionType, newCount) {
    if (AIRTABLE_CONFIG.apiKey === 'YOUR_API_KEY' || storyId.startsWith('sample') || storyId.startsWith('local_')) {
        console.log('æ¨¡æ“¬æ›´æ–°åæ‡‰:', storyId, reactionType, newCount);
        return;
    }

    try {
        const fieldName = reactionType === 'heart' ? 'å¿ƒå‹•â™¡æ•¸é‡' :
                          reactionType === 'relate' ? 'æˆ‘ä¹Ÿæ˜¯' : 'å¥½æº«æš–';

        const response = await fetch(`https://api.airtable.com/v0/${AIRTABLE_CONFIG.baseId}/${AIRTABLE_CONFIG.tableName}/${storyId}`, {
            method: 'PATCH',
            headers: {
                'Authorization': `Bearer ${AIRTABLE_CONFIG.apiKey}`,
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                fields: {
                    [fieldName]: newCount
                }
            })
        });

        if (!response.ok) {
            throw new Error('ç„¡æ³•æ›´æ–°åæ‡‰');
        }
    } catch (error) {
        console.error('æ›´æ–°åæ‡‰å¤±æ•—:', error);
    }
}


        // ç”Ÿæˆè¨˜æ†¶å¡ç‰‡
        function createMemoryCard(memory, index) {
            const card = document.createElement('div');
            card.className = 'memory-card';
            card.innerHTML = `
                <div class="memory-tag">${memory.type}</div>
                <h3 style="margin-bottom: 10px; color: #333;">${memory.title}</h3>
                <div class="memory-content">${memory.content}</div>
                ${memory.nickname && memory.nickname !== 'åŒ¿å' ? `<div style="font-size: 0.9rem; color: #888; margin-top: 10px;">by ${memory.nickname}</div>` : ''}
                <div class="reaction-buttons">
                    <button class="reaction-btn heart" onclick="addReaction('${memory.id}', ${index}, 'heart')">
                        â™¡ <span class="reaction-count">${memory.reactions.heart}</span>
                    </button>
                    <button class="reaction-btn relate" onclick="addReaction('${memory.id}', ${index}, 'relate')">
                        æˆ‘ä¹Ÿæ˜¯ <span class="reaction-count">${memory.reactions.relate}</span>
                    </button>
                    <button class="reaction-btn warm" onclick="addReaction('${memory.id}', ${index}, 'warm')">
                        å¥½æº«æš– <span class="reaction-count">${memory.reactions.warm}</span>
                    </button>
                </div>
            `;
            return card;
        }

        // æ·»åŠ åæ‡‰
        async function addReaction(storyId, index, type) {
            const button = event.target.closest('.reaction-btn');
            
            // é˜²æ­¢é‡è¤‡é»æ“Š
            if (button.disabled) return;
            button.disabled = true;
            
            try {
                memories[index].reactions[type]++;
                const newCount = memories[index].reactions[type];
                
                // æ›´æ–°åˆ° Airtable
                await updateReactionInAirtable(storyId, type, newCount);
                
                // æ›´æ–°UI
                updateMemoryWall();
                createFloatingHeart(button);
                
                // é¡¯ç¤ºæˆåŠŸæç¤º
                showToast('æ„Ÿè¬ä½ çš„å›æ‡‰ï¼â™¡');
            } catch (error) {
                // å¦‚æœæ›´æ–°å¤±æ•—ï¼Œå›å¾©åŸç‹€
                memories[index].reactions[type]--;
                updateMemoryWall();
                showToast('å›æ‡‰å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦', 'error');
            } finally {
                button.disabled = false;
            }
        }

        // å‰µå»ºæµ®å‹•æ„›å¿ƒ
        function createFloatingHeart(element) {
            const heart = document.createElement('div');
            heart.className = 'floating-heart';
            heart.innerHTML = 'â™¡';
            heart.style.left = element.offsetLeft + 'px';
            heart.style.top = element.offsetTop + 'px';
            
            document.getElementById('floatingHearts').appendChild(heart);
            
            setTimeout(() => {
                heart.remove();
            }, 3000);
        }

        // æ›´æ–°è¨˜æ†¶ç‰†
        function updateMemoryWall() {
            const memoryWall = document.getElementById('memoryWall');
            memoryWall.innerHTML = '';
            
            if (memories.length === 0) {
                memoryWall.innerHTML = '<div style="text-align: center; padding: 40px; color: #666;">è¼‰å…¥ä¸­...</div>';
                return;
            }
            
            memories.forEach((memory, index) => {
                const card = createMemoryCard(memory, index);
                memoryWall.appendChild(card);
            });
        }

        // è™•ç†è¡¨å–®æäº¤
        document.getElementById('submitForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const submitButton = this.querySelector('.submit-btn');
            const originalText = submitButton.textContent;
            
            // é˜²æ­¢é‡è¤‡æäº¤
            if (submitButton.disabled) return;
            submitButton.disabled = true;
            submitButton.textContent = 'æäº¤ä¸­...';
            
            try {
                const formData = new FormData(this);
                const storyData = {
                    type: formData.get('storyType') || 'å…¶ä»–',
                    title: formData.get('storyTitle') || 'ç„¡æ¨™é¡Œ',
                    content: formData.get('storyContent'),
                    nickname: formData.get('nickname') || 'åŒ¿å'
                };
                
                if (!storyData.content.trim()) {
                    throw new Error('è«‹å¡«å¯«ä½ çš„é’æ˜¥æ•…äº‹');
                }
                
                // æäº¤åˆ° Airtable
                const newMemory = await submitStoryToAirtable(storyData);
                
                // æ·»åŠ åˆ°æœ¬åœ°é¡¯ç¤º
                memories.unshift(newMemory);
                updateMemoryWall();
                updateStats();
                
                // é‡ç½®è¡¨å–®
                this.reset();
                
                // é¡¯ç¤ºæˆåŠŸè¨Šæ¯
                showToast('æ„Ÿè¬ä½ åˆ†äº«é’æ˜¥æ•…äº‹ï¼â™¡', 'success');
                
            } catch (error) {
                console.error('æäº¤å¤±æ•—:', error);
                showToast(error.message || 'æäº¤å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦', 'error');
            } finally {
                submitButton.disabled = false;
                submitButton.textContent = originalText;
            }
        });

        // é¡¯ç¤ºæç¤ºè¨Šæ¯
        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            const bgColor = type === 'success' ? '#4CAF50' : 
                           type === 'error' ? '#f44336' : '#2196F3';
            
            toast.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 25px;
                border-radius: 8px;
                color: white;
                font-weight: 500;
                z-index: 10000;
                animation: slideInRight 0.3s ease-out;
                background: ${bgColor};
                box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            `;
            toast.textContent = message;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.animation = 'slideOutRight 0.3s ease-out';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // è¼‰å…¥æ•…äº‹
        async function loadStories() {
            try {
                showLoadingState();
                memories = await fetchStoriesFromAirtable();
                updateMemoryWall();
                updateStats();
            } catch (error) {
                console.error('è¼‰å…¥æ•…äº‹å¤±æ•—:', error);
                showToast('è¼‰å…¥æ•…äº‹å¤±æ•—ï¼Œè«‹é‡æ–°æ•´ç†é é¢', 'error');
            }
        }

        // é¡¯ç¤ºè¼‰å…¥ç‹€æ…‹
        function showLoadingState() {
            const memoryWall = document.getElementById('memoryWall');
            memoryWall.innerHTML = `
                <div style="text-align: center; padding: 40px; color: #666;">
                    <div style="font-size: 2rem; margin-bottom: 10px;">ğŸ’­</div>
                    <div>æ­£åœ¨è¼‰å…¥é’æ˜¥æ•…äº‹...</div>
                </div>
            `;
        }

        // æ›´æ–°çµ±è¨ˆæ•¸æ“š
        function updateStats() {
            document.getElementById('storyCount').textContent = memories.length;
            document.getElementById('objectCount').textContent = memories.filter(m => m.type === 'çè—ç‰©ä»¶').length + 28;
            document.getElementById('secretCount').textContent = memories.filter(m => m.type === 'é’æ˜¥ç§˜å¯†').length + 31;
        }

        // é é¢åŠ è¼‰æ™‚åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // è¼‰å…¥æ•…äº‹
            loadStories();
            
            // æ·»åŠ CSSå‹•ç•«
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideInRight {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
                
                @keyframes slideOutRight {
                    from { transform: translateX(0); opacity: 1; }
                    to { transform: translateX(100%); opacity: 0; }
                }
            `;
            document.head.appendChild(style);
            
            // æ·»åŠ æ»¾å‹•æ•ˆæœ
            window.addEventListener('scroll', function() {
                const cards = document.querySelectorAll('.memory-card');
                cards.forEach(card => {
                    const rect = card.getBoundingClientRect();
                    if (rect.top < window.innerHeight && rect.bottom > 0) {
                        card.style.opacity = '1';
                        card.style.transform = 'translateY(0)';
                    }
                });
            });
            
            // è¨­å®šæç¤ºï¼ˆå¦‚æœä½¿ç”¨ç¤ºä¾‹è³‡æ–™ï¼‰
            if (AIRTABLE_CONFIG.apiKey === 'YOUR_API_KEY') {
                setTimeout(() => {
                    showToast('ç›®å‰ä½¿ç”¨ç¤ºä¾‹è³‡æ–™ï¼Œè«‹è¨­å®š Airtable ä»¥å•Ÿç”¨çœŸå¯¦è³‡æ–™åº«åŠŸèƒ½', 'info');
                }, 2000);
            }
        });
    </script>
</body>
</html>
